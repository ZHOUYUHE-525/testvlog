<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê±âËØ≠ Vlog | ÂºÄÂêØÊ≤âÊµ∏ÂºèÁîµÂΩ±ËØæÂ†Ç</title>
    
    <!-- üü¢ App ÂõæÊ†áÂíåÊâãÊú∫Á´ØËÆæÁΩÆ -->
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- ÂºïÂÖ•ËµÑÊ∫ê -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- üü¢ ÂºïÂÖ•‰øùÂÆâËÑöÊú¨ÔºàÂøÖÈ°ªÂú®ÊúÄÂâçÔºåÂ§ÑÁêÜËá™Âä®Ë∑≥ËΩ¨Ôºâ -->
    <script src="auth.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6CAD9C;
            --accent: #E5CC84;
            --glass: rgba(255, 255, 255, 0.08);
            --bg-dark: #0a0a0a;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: "PingFang SC", "Microsoft YaHei", sans-serif; background: var(--bg-dark); color: white; overflow-x: hidden; scroll-behavior: smooth; }

        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.8) 100%), 
                        url('https://images.unsplash.com/photo-1485846234645-a62644f84728?q=80&w=2059&auto=format&fit=crop'); 
            background-size: cover; background-position: center;
            z-index: -1; transform: scale(1.05); transition: transform 8s ease-out;
        }
        body.loaded .bg-overlay { transform: scale(1); }

        .top-nav { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .lang-btn { background: var(--glass); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px 20px; border-radius: 25px; cursor: pointer; backdrop-filter: blur(15px); font-size: 13px; font-weight: bold; transition: 0.3s; }
        .lang-btn:hover { background: rgba(255,255,255,0.2); border-color: var(--accent); }

        .wrapper { display: flex; flex-direction: column; align-items: center; padding: 100px 20px 60px 20px; }

        .login-card {
            background: var(--glass);
            backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px; padding: 40px; width: 100%; max-width: 380px;
            text-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.5);
            margin-bottom: 80px;
        }

        .logo-area i { font-size: 50px; color: var(--accent); margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(229, 204, 132, 0.5)); }
        .logo-area h1 { font-size: 28px; margin: 0; letter-spacing: 3px; font-weight: 900; }

        .input-group { margin-top: 30px; text-align: left; }
        .input-group label { display: block; font-size: 12px; margin-bottom: 8px; opacity: 0.6; }
        input {
            width: 100%; padding: 15px; border-radius: 15px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: white; outline: none; transition: 0.3s; box-sizing: border-box; font-size: 15px;
        }
        input:focus { border-color: var(--primary); background: rgba(255,255,255,0.1); }

        .btn-main {
            width: 100%; padding: 16px; border: none; border-radius: 15px;
            background: linear-gradient(135deg, var(--primary) 0%, #4facfe 100%);
            color: white; font-weight: 800; font-size: 16px; cursor: pointer; transition: 0.3s; margin-top: 25px;
        }
        .btn-main:hover { transform: translateY(-2px); filter: brightness(1.1); }

        .toggle-link { margin-top: 25px; font-size: 13px; color: var(--accent); cursor: pointer; opacity: 0.8; }

        .pricing-list { width: 100%; max-width: 480px; display: flex; flex-direction: column; gap: 30px; }
        .price-item {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px; padding: 35px; position: relative; backdrop-filter: blur(10px);
            transition: 0.4s;
        }
        .price-item.active { border-color: var(--accent); background: rgba(229, 204, 132, 0.03); border-width: 2px; }
        
        .price-item h3 { margin: 0; color: var(--accent); font-size: 22px; display: flex; align-items: center; gap: 10px; }
        .price-row { display: flex; align-items: baseline; gap: 12px; margin: 20px 0 5px 0; }
        .price-now { font-size: 38px; font-weight: 900; color: white; }
        .price-old { font-size: 18px; color: #888; text-decoration: line-through; opacity: 0.7; }
        .price-remark { font-size: 14px; color: #bbb; display: block; margin-bottom: 20px; }

        .features { padding: 0; list-style: none; text-align: left; margin: 0; }
        .features li { font-size: 14px; margin-bottom: 12px; opacity: 0.85; display: flex; align-items: flex-start; gap: 12px; line-height: 1.5; }
        .features li i { color: var(--primary); margin-top: 4px; font-size: 14px; }
        
        .coming-soon { position: absolute; top: 20px; right: 20px; font-size: 10px; background: var(--accent); color: #000; padding: 4px 10px; border-radius: 10px; font-weight: bold; }

        #msg { margin-top: 15px; font-size: 13px; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

    <div class="bg-overlay"></div>

    <div class="top-nav">
        <button class="lang-btn" onclick="toggleLang()" id="langBtn">üá∑üá∫ RU / üá∫üá∏ EN / üá®üá≥ CN</button>
    </div>

    <div class="wrapper">
        <div class="login-card">
            <div class="logo-area">
                <i class="fas fa-film"></i>
                <h1 id="brandName">Ê±âËØ≠ Vlog</h1>
                <p id="modeDesc">Ê≤âÊµ∏ÂºèÂ≠¶Ê±âËØ≠ ¬∑ ÁôªÂΩï‰∏≠ÂøÉ</p>
            </div>

            <div class="input-group">
                <label id="labelEmail">Ë¥¶Âè∑ / Email / –õ–æ–≥–∏–Ω</label>
                <input type="email" id="email" placeholder="email@example.com">
            </div>
            <div class="input-group">
                <label id="labelPwd">ÂØÜÁ†Å / Password / –ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>

            <button class="btn-main" onclick="handleAuthAction()" id="actionBtn">ÁôªÂΩï / Login / –í–æ–π—Ç–∏</button>
            <div id="msg"></div>

            <div class="toggle-link" onclick="toggleMode()" id="toggleBtn">
                ËøòÊ≤°ÊúâË¥¶Âè∑ÔºüÁÇπÂáªËøôÈáåÊ≥®ÂÜåÊñ∞Áî®Êà∑
            </div>
        </div>

        <div class="pricing-list" id="pricingList">
            <!-- Áî± JS Â°´ÂÖÖ -->
        </div>
    </div>

    <script>
        const LOGIN_URL = 'https://bwweaohahsafbecogist.supabase.co'; 
        const LOGIN_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ3d2Vhb2hhaHNhZmJlY29naXN0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NTk3MjMsImV4cCI6MjA4NDMzNTcyM30.ZqViPiwlvzzaqkWLMzejjpgHXeztkD0K0ne32kfGhWw';
        const loginClient = window.supabase.createClient(LOGIN_URL, LOGIN_KEY);

        let currentLang = 'ru';
        let isSignUpMode = false;
        let isBusy = false;

        const uiDict = {
            ru: {
                brand: "–ö–∏—Ç–∞–π—Å–∫–∏–π Vlog", login_desc: "–ò–∑—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–ª–æ–≥–∏", go_signup: "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç", go_login: "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏", btn_login: "–í–æ–π—Ç–∏", btn_signup: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è", msg_processing: "–û–±—Ä–∞–±–æ—Ç–∫–∞...",
                plans: [
                    { title: "–ü—Ä–æ–±–Ω–∞—è –≤–µ—Ä—Å–∏—è", price: "$0", features: ["–ü—Ä–æ—Å–º–æ—Ç—Ä 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏", "–î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º —Å–∞–π—Ç–∞", "–ü–µ—á–∞—Ç—å —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è 3 —É—Ä–æ–∫–æ–≤", "PDF –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è", "–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 24 —á–∞—Å–∞"] },
                    { title: "–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è (–°–µ–∑–æ–Ω 1)", price: "$29.9", old: "$49.9", remark: "(~ 2250P / 208¬•)", features: ["120 –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ—É—Ä–æ–∫–æ–≤", "–ë–û–ù–£–°: 30 –≤–∏–¥–µ–æ —Ç–æ–∫-—à–æ—É", "–ü–µ—á–∞—Ç—å –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤", "–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö PDF-–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤", "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö", "–í–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø"], active: true },
                    { title: "–°–µ–∑–æ–Ω 2", price: "-", soon: "–°–ö–û–†–û", features: ["–û–∂–∏–¥–∞–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π..."] },
                    { title: "–°—É–ø–µ—Ä VIP", price: "$80", soon: "–°–ö–û–†–û", features: ["–í—Å–µ –≤–∏–¥–µ–æ: Vlog, HSK", "–í—Å–µ –°–µ—Ä–∏–∞–ª—ã –∏ –ö–∏–Ω–æ", "–ù–æ–≤–æ—Å—Ç–∏ –∏ –¢–í-—à–æ—É"] }
                ]
            },
            en: {
                brand: "Hanyu Vlog", login_desc: "Learn Chinese through Vlogs", go_signup: "New user? Sign Up", go_login: "Have account? Log In", btn_login: "Log In", btn_signup: "Sign Up", msg_processing: "Processing...",
                plans: [
                    { title: "Trial Version", price: "$0", features: ["Watch 3 videos upon registration", "All interactive features", "Print 3 scripts only", "PDF textbooks not downloadable", "Validity: 24 hours"] },
                    { title: "Full Access (Season 1)", price: "$29.9", old: "$49.9", remark: "(approx. 2250P / 208¬•)", features: ["120 essential short videos", "Bonus: 30 Talk Show videos", "Unlimited script printing", "Free download of all PDFs", "Cloud sync for vocab & data", "One-time payment, lifetime access"], active: true },
                    { title: "Season 2", price: "-", soon: "COMING SOON", features: ["Stay tuned..."] },
                    { title: "Super Member", price: "$80", soon: "COMING SOON", features: ["All videos: Vlog, HSK", "TV Dramas & Movies", "News & Variety Shows"] }
                ]
            },
            cn: {
                brand: "Ê±âËØ≠ Vlog ËØæÂ†Ç", login_desc: "Ê≤âÊµ∏ÂºèÂ≠¶Ê±âËØ≠ ¬∑ ÁôªÂΩï‰∏≠ÂøÉ", go_signup: "ËøòÊ≤°ÊúâË¥¶Âè∑ÔºüÁÇπÂáªËøôÈáåÊ≥®ÂÜåÊñ∞Áî®Êà∑", go_login: "Â∑≤ÊúâË¥¶Âè∑ÔºüËøîÂõûÁôªÂΩï", btn_login: "ÁôªÂΩï / Login / –í–æ–π—Ç–∏", btn_signup: "Ê≥®ÂÜå / Sign Up / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è", msg_processing: "Â§ÑÁêÜ‰∏≠ / Processing...",
                plans: [
                    { title: "ËØïÁî®Áâà", price: "$0", features: ["Ê≥®ÂÜåÂèØËßÇÁúã 3 ‰∏™ËßÜÈ¢ë", "‰ΩìÈ™åÁΩëÁ´ôÂÜÖÊâÄÊúâÂäüËÉΩ", "‰ªÖÂèØÊâìÂç∞ 3 ‰∏™ËØæÊó∂Âè∞ËØç", "ÁîµÂ≠êËØæÊú¨ (PDF) ‰∏çÂèØ‰∏ãËΩΩ", "ÊúâÊïàÊúü 24 Â∞èÊó∂"] },
                    { title: "Ê≠£ÂºèÁâà (Á¨¨‰∏ÄÂ≠£)", price: "$29.9", old: "$49.9", remark: "(2250P / 208¬•)", features: ["120 ‰∏™Á≤æÂΩ©Áü≠ËßÜÈ¢ë", "ÈôêÊó∂Ëµ†ÈÄÅ 30 ‰∏™ËÑ±Âè£ÁßÄ", "Âè∞ËØçÂâßÊú¨Êó†ÈôêÊâìÂç∞", "ÊâÄÊúâ PDF ËØæÊú¨ÂÖçË¥π‰∏ãËΩΩ", "ÁîüËØçÊú¨ÂèäÊï∞ÊçÆ‰∫ëÁ´ØÂêåÊ≠•", "‰π∞Êñ≠Âà∂Ôºå‰∏ÄÊ¨°‰ªòÊ¨æÊ∞∏‰πÖËßÇÁúã"], active: true },
                    { title: "Á¨¨‰∫åÂ≠£", price: "-", soon: "Êï¨ËØ∑ÊúüÂæÖ", features: ["Âç≥Â∞Ü‰∏äÁ∫øÔºåÊï¨ËØ∑ÂÖ≥Ê≥®"] },
                    { title: "Ë∂ÖÁ∫ß‰ºöÂëò", price: "$80", soon: "Êï¨ËØ∑ÊúüÂæÖ", features: ["ÁΩëÁ´ôÊâÄÊúâËßÜÈ¢ë: Vlog/HSK", "ÂÖ®Á´ôÁîµËßÜÂâßÂèäÁîµÂΩ±ËµÑÊ∫ê", "ÂÖ®Á´ôÊñ∞ÈóªÂèäÁªºËâ∫ËßÜÈ¢ë"] }
                ]
            }
        };

        function updateUI() {
            const dict = uiDict[currentLang];
            document.getElementById('brandName').innerText = dict.brand;
            document.getElementById('actionBtn').innerText = isSignUpMode ? dict.btn_signup : dict.btn_login;
            document.getElementById('toggleBtn').innerText = isSignUpMode ? dict.go_login : dict.go_signup;
            document.getElementById('modeDesc').innerText = dict.login_desc;
            const list = document.getElementById('pricingList');
            list.innerHTML = dict.plans.map(p => `
                <div class="price-item ${p.active ? 'active' : ''}">
                    ${p.soon ? `<span class="coming-soon">${p.soon}</span>` : ''}
                    <h3><i class="fas ${p.soon ? 'fa-hourglass-half' : 'fa-check-circle'}"></i> ${p.title}</h3>
                    <div class="price-row"><span class="price-now">${p.price}</span>${p.old ? `<span class="price-old">${p.old}</span>` : ''}</div>
                    ${p.remark ? `<span class="price-remark">${p.remark}</span>` : ''}
                    <ul class="features">${p.features.map(f => `<li><i class="fas fa-caret-right"></i> ${f}</li>`).join('')}</ul>
                </div>`).join('');
        }

        function toggleLang() {
            if (currentLang === 'ru') currentLang = 'en';
            else if (currentLang === 'en') currentLang = 'cn';
            else currentLang = 'ru';
            updateUI();
        }

        function toggleMode() { isSignUpMode = !isSignUpMode; updateUI(); }

        async function handleAuthAction() {
            if (isBusy) return;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const msg = document.getElementById('msg');
            const btn = document.getElementById('actionBtn');
            if(!email || !password) { msg.style.color = "#ff4d4f"; msg.innerText = "Error: Input required"; return; }
            isBusy = true; btn.disabled = true; msg.innerText = uiDict[currentLang].msg_processing;

            try {
                if (isSignUpMode) {
                    const { data, error } = await loginClient.auth.signUp({ email, password });
                    if (error) throw error;
                    msg.style.color = "#E5CC84";
                    msg.innerText = "Success! Log in to start trial.";
                    setTimeout(() => { toggleMode(); isBusy = false; btn.disabled = false; }, 1500);
                } else {
                    const { data, error } = await loginClient.auth.signInWithPassword({ email, password });
                    if (error) throw error;

                    // üî¥ ÂÖ≥ÈîÆÈÄªËæë 1Ôºö‰∫íË∏¢Â≠òÊ†π
                    const newToken = Date.now() + "_" + Math.random();
                    await loginClient.from('profiles').upsert({ id: data.user.id, session_token: newToken });
                    localStorage.setItem('my_session_token', newToken);

                    // üî¥ ÂÖ≥ÈîÆÈÄªËæë 2ÔºöËøõÂ∫¶ÊãâÂèñ
                    const { data: profile } = await loginClient.from('profiles').select('progress, access_tags').eq('id', data.user.id).maybeSingle();
                    if (profile) {
                        if(profile.progress) Object.keys(profile.progress).forEach(k => localStorage.setItem(k, profile.progress[k]));
                        if(profile.access_tags) localStorage.setItem('my_access_tags', JSON.stringify(profile.access_tags));
                    }
                    
                    msg.style.color = "#6CAD9C";
                    msg.innerText = "Welcome back! Redirecting...";
                    setTimeout(() => { window.location.href = 'home.html?from_login=1'; }, 1000);
                }
            } catch (err) {
                msg.style.color = "#ff4d4f"; msg.innerText = err.message;
                isBusy = false; btn.disabled = false;
            }
        }
        document.addEventListener('DOMContentLoaded', () => { document.body.classList.add('loaded'); updateUI(); });
        document.addEventListener('keydown', (e) => { if(e.key === 'Enter') handleAuthAction(); });
    </script>
</body>
</html>
